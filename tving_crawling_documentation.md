# Tving 콘텐츠 크롤러 기술 문서

## 1. 프로젝트 개요

**목표:**

*   Tving 웹사이트의 특정 장르 및 서브 장르 페이지에 있는 모든 콘텐츠의 상세 정보를 수집합니다.
*   병렬 크롤링을 통해 여러 카테고리의 데이터를 동시에 효율적으로 수집합니다.
*   수집된 데이터(제목, 설명, 썸네일, 연령 등급, 출연진)를 장르별, 서브 장르별로 구조화하여 각각의 CSV 파일로 저장합니다.

**주요 기술:**

*   **Crawling:** Selenium, BeautifulSoup4
*   **Data Handling:** Pandas
*   **Concurrency:** `concurrent.futures.ThreadPoolExecutor`

## 2. 시스템 아키텍처 및 작업 흐름

본 크롤러는 단일 스크립트(`tving_crawling.py`) 내에서 병렬 처리 아키텍처를 구현하여 작동합니다.

```
+---------------------------------+
|          main (실행부)          |
+---------------------------------+
             | (ThreadPoolExecutor 생성)
             | 5개 Worker Thread에 작업 분배
+----------------+----------------+----------------+-- ...
|    Worker 1    |    Worker 2    |    Worker 3    |
| (crawl_tving)  | (crawl_tving)  | (crawl_tving)  |
+----------------+----------------+----------------+-- ...
      |                |                |
 (영화-드라마 URL) (영화-로맨스 URL) (영화-코미디 URL)
      |                |                |
      v                v                v
+----------+     +----------+     +----------+
| CSV 파일 |     | CSV 파일 |     | CSV 파일 |
+----------+     +----------+     +----------+
```

**작업 흐름:**

1.  **실행 시작:** `if __name__ == "__main__":` 블록에서 `ThreadPoolExecutor`가 최대 5개의 워커 스레드를 가진 풀을 생성합니다.
2.  **작업 분배:** 스크립트 상단에 하드코딩된 `genre_links` 리스트(장르, 서브 장르, URL 튜플의 집합)를 순회하며 각 URL에 대한 크롤링 작업을 스레드 풀에 제출(submit)합니다.
3.  **병렬 크롤링 (`crawl_tving_category` 함수):**
    *   각 워커 스레드는 `crawl_tving_category` 함수를 실행하며, 독립적인 Selenium WebDriver 인스턴스를 생성합니다.
    *   담당 장르 페이지 URL로 이동합니다.
    *   **동적 콘텐츠 로딩:** 페이지 하단으로 스크롤을 10회 반복하여 '무한 스크롤' 방식으로 숨겨져 있는 모든 콘텐츠가 로드되도록 합니다.
    *   페이지의 모든 콘텐츠 링크(`a[href^='/contents/']`)를 수집합니다.
    *   **개별 콘텐츠 페이지 순회:** 수집된 각 콘텐츠 링크를 하나씩 방문합니다.
    *   **상세 정보 추출:** BeautifulSoup을 사용하여 현재 페이지의 HTML을 파싱하고, 제목, 설명, 썸네일, 연령 등급, 출연진 정보를 추출합니다. (상세 로직은 3.1 참고)
    *   추출된 데이터를 리스트에 추가합니다.
4.  **데이터 저장:**
    *   한 장르의 모든 콘텐츠 정보 수집이 끝나면, Pandas DataFrame으로 변환합니다.
    *   장르 이름으로 된 디렉토리(예: `./영화/`)를 생성하고, 그 안에 `tving_{장르}_{서브장르}.csv` 형식의 파일로 저장합니다.
5.  **종료:** 모든 스레드의 작업이 완료되면 "전체 병렬 크롤링 완료!" 메시지를 출력하고 종료합니다.

## 3. 핵심 알고리즘 및 데이터 전처리/정제 방식

### 3.1. 데이터 추출 및 정제 로직

HTML 구조에 의존하여 CSS 선택자(Selector)를 통해 원하는 정보를 정확히 찾아내고, 후처리 과정을 거쳐 데이터를 정제합니다.

*   **제목(Title):**
    *   `<img>` 태그의 `alt` 속성에 프로그램 제목이 명시되어 있는 점을 활용합니다. `soup.select_one("img[alt]")`로 해당 태그를 찾고 `alt` 속성값을 추출합니다.

*   **설명(Description):**
    *   두 단계의 폴백(Fallback) 로직을 사용합니다.
    1.  **1순위:** 페이지 내의 모든 `<p>` (문단) 태그 중 텍스트 길이가 가장 긴 것을 프로그램의 메인 설명으로 간주합니다. 이는 일반적으로 가장 상세한 줄거리를 담고 있을 가능성이 높기 때문입니다.
    2.  **2순위:** 적절한 `<p>` 태그를 찾지 못할 경우, SEO(검색 엔진 최적화)를 위해 정의된 Open Graph 메타 태그인 `meta[property='og:description']`의 `content` 속성값을 가져옵니다.

*   **썸네일(Thumbnail):**
    *   `img.loaded` CSS 클래스를 가진 모든 이미지 태그를 선택합니다.
    *   이 중에서 `src` 속성에 `.jpg` 확장자와 `/resize/480` 문자열이 모두 포함된 첫 번째 이미지 URL을 선택합니다. 이는 고화질의 표준 썸네일 이미지를 특정하기 위한 규칙입니다.

*   **연령 등급(Age Rating):**
    *   `.tag-age` 클래스를 가진 `<div>` 태그를 찾습니다.
    *   해당 태그의 클래스 목록(예: `tag-age-fifteen`)에서 `tag-age-` 접두사로 시작하는 클래스명을 분석하여 `fifteen`과 같은 등급 코드를 추출합니다.
    *   추출된 코드를 `전체 이용가`, `7세 이상`, `15세 이상` 등 표준적인 한글 문자열로 매핑합니다.

*   **출연진(Cast):**
    *   `<dt>` (정의 목록의 용어) 태그 중 텍스트가 "출연"인 것을 찾습니다.
    *   찾은 태그 바로 다음에 오는 형제 태그인 `<dd>` (정의 목록의 설명)의 텍스트를 추출하여 출연진 정보로 사용합니다.

### 3.2. 동적 콘텐츠 로딩 처리

*   Tving의 장르 페이지는 사용자가 스크롤을 내려야 추가 콘텐츠를 로드하는 '무한 스크롤' 방식을 사용합니다.
*   이를 처리하기 위해 `driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")` 코드를 정해진 횟수(10회)만큼 반복 실행합니다.
*   각 스크롤 사이에 `time.sleep(2)`를 두어 새로운 콘텐츠가 로드될 충분한 시간을 확보합니다.

## 4. 실행 방법 및 요구사항

1.  **필수 라이브러리 설치:**
    ```bash
    pip install pandas beautifulsoup4 selenium
    ```

2.  **WebDriver 설정:**
    *   `selenium`이 제어할 수 있는 ChromeDriver가 시스템에 설치되어 있고, PATH에 잡혀 있어야 합니다.

3.  **실행:**
    ```bash
    python tving_crawling.py
    ```

4.  **결과물:**
    *   스크립트 실행 위치에 `영화`, `드라마`, `예능`, `애니` 디렉토리가 생성됩니다.
    *   각 디렉토리 안에 `tving_{장르}_{서브장르}.csv` 형식으로 콘텐츠 정보가 저장됩니다.

## 5. 디렉토리 구조 (실행 후)

```
tving_crawler/
├── tving_crawling.py
├── 드라마/
│   ├── tving_드라마_로맨스.csv
│   ├── tving_드라마_판타지.csv
│   └── ...
├── 영화/
│   ├── tving_영화_액션.csv
│   └── ...
├── 예능/
│   └── ...
└── 애니/
    └── ...
```